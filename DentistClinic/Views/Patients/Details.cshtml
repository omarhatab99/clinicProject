@model PatientViewModel;
@inject UserManager<ApplicationUser> userManger;
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery antiforgery;
@{
    // Layout = null;
    ViewData["Title"] = "Details";
}


@section Styles {
    <link rel="stylesheet" href="~/assets/Plugins/datatables/datatables.bundle.css" />
}
<div class="card mb-10">
    <div class="card-body pt-9 pb-0">
        <!--begin::Details-->
        <div class="d-flex flex-wrap flex-sm-nowrap mb-6">
            <!--begin::Image-->
            <div class="d-flex flex-center flex-shrink-0 bg-light rounded w-100px h-100px w-lg-150px h-lg-150px me-7 mb-4">
                <img class="mw-50px mw-lg-75px patient-image" src="~/assets/images/user.jpg" alt="image">
            </div>
            <!--end::Image-->
            <!--begin::Wrapper-->
            <div class="flex-grow-1">
                <!--begin::Head-->
                <div class="d-flex justify-content-between align-items-start flex-wrap mb-2">
                    <!--begin::Details-->
                    <div class="d-flex flex-column">
                        <!--begin::Status-->
                        <div class="d-flex align-items-center mb-1">
                            <a href="#" class="text-gray-800 text-hover-primary fs-2 fw-bold me-3 patient-name">@Model.FullName</a>
                            <span class="badge badge-light-success patient-type me-2">
                                @if(userManger.Users.Any(x => x.PatientId == Model.Id))
                                {
                                    <span>online patient</span>
                                }
                                else
                                {
                                    <span>offline patient</span>
                                }
                            </span>
                        </div>
                        <!--end::Status-->
                        <!--begin::Description-->
                        <div class="d-flex flex-wrap fw-semibold mb-4 fs-5 text-gray-500 patient-address">
                            @Model.Address
                        </div>
                        <!--end::Description-->
                    </div>
                    <!--end::Details-->
                    <!--begin::Actions-->
                    <div class="d-flex mb-4">
                        <a class="btn btn-sm btn-secondary me-3" asp-controller="Patients" asp-action="Index">Back to List</a>
                    </div>
                    <!--end::Actions-->
                </div>
                <!--end::Head-->
                <!--begin::Info-->
                <div class="d-flex flex-wrap justify-content-start">
                    <!--begin::Stats-->
                    <div class="d-flex flex-wrap">
                        <!--begin::Stat-->
                        <div class="border border-gray-300 border-dashed rounded min-w-125px py-3 px-4 me-6 mb-3">
                            <!--begin::Number-->
                            <div class="d-flex align-items-center">
                                <div class="fs-4 fw-bold patient-birthdate">@Model.BirthDate.ToShortDateString()</div>
                            </div>
                            <!--end::Number-->
                            <!--begin::Label-->
                            <div class="fw-semibold fs-6 text-gray-500">Birthdate</div>
                            <!--end::Label-->
                        </div>
                        <!--end::Stat-->
                        <!--begin::Stat-->
                        <div class="border border-gray-300 border-dashed rounded min-w-125px py-3 px-4 me-6 mb-3">
                            <!--begin::Number-->
                            <div class="d-flex align-items-center">
                                <i class="fa-solid fa-file-invoice-dollar text-success me-2"></i>
                                <div class="fs-4 fw-bold counted patient-payments" data-kt-countup="true" data-kt-countup-value=@Model.CurentBalance data-kt-initialized="1">@Model.CurentBalance</div>
                            </div>
                            <!--end::Number-->
                            <!--begin::Label-->
                            <div class="fw-semibold fs-6 text-gray-500">Payments</div>
                            <!--end::Label-->
                        </div>
                        <!--end::Stat-->
                        <!--begin::Stat-->
                        <div class="border border-gray-300 border-dashed rounded min-w-125px py-3 px-4 me-6 mb-3">
                            <!--begin::Number-->
                            <div class="d-flex align-items-center">
                                <i class="fa-solid fa-file-invoice-dollar text-danger me-2"></i>
                                <div class="fs-4 fw-bold counted patient-current-balance" data-kt-countup="true" data-kt-countup-value=@Model.CurentBalance data-kt-countup-prefix="$" data-kt-initialized="1">@Model.CurentBalance <span class="mx-2">EGP</span> </div>
                            </div>
                            <!--end::Number-->
                            <!--begin::Label-->
                            <div class="fw-semibold fs-6 text-gray-500">Current Balance</div>
                            <!--end::Label-->
                        </div>
                        <!--end::Stat-->
                    </div>
                    <!--end::Stats-->
                    <!--begin::Users-->
                    <div class="d-flex align-items-center flex-wrap mb-1">
                        <span class="badge badge-light-info patient-type me-2 mb-2">@Model.Gender</span>
                        <span class="badge badge-light-info patient-phone me-2 mb-2">@Model.PhoneNumber</span>
                        <span class="badge badge-light-info patient-occupation me-2 mb-2">@Model.Occupation</span>
                    </div>
                    <!--end::Users-->
                </div>
                <!--end::Info-->
            </div>
            <!--end::Wrapper-->
        </div>
        <!--end::Details-->

        <div class="separator"></div>

        <!--begin::Nav-->
        <ul class="nav nav-stretch nav-line-tabs nav-line-tabs-2x border-transparent fs-5 fw-bold">
            <!--begin::Nav item-->
            <li class="nav-item">
                <a class="nav-link text-active-primary py-5 me-6 active" data-bs-toggle="tab" href="#kt_tab_pane_1">
                    Overview
                </a>
            </li>
            <!--end::Nav item-->
            <!--begin::Nav item-->
            <li class="nav-item">
                <a class="nav-link text-active-primary py-5 me-6" data-bs-toggle="tab" href="#kt_tab_pane_2">
                    Reservations
                </a>
            </li>
            <!--end::Nav item-->
            <!--begin::Nav item-->
            <li class="nav-item">
                <a class="nav-link text-active-primary py-5 me-6" data-bs-toggle="tab" href="#kt_tab_pane_3">
                    Prescriptions
                </a>
            </li>
            <!--end::Nav item-->
            <!--begin::Nav item-->
            <li class="nav-item">
                <a class="nav-link text-active-primary py-5 me-6" data-bs-toggle="tab" href="#kt_tab_pane_4">
                    Medical Report
                </a>
            </li>
            <!--end::Nav item-->
            <!--begin::Nav item-->
            <li class="nav-item">
                <a class="nav-link text-active-primary py-5 me-6" data-bs-toggle="tab" href="#kt_tab_pane_5">
                    Payments
                </a>
            </li>
            <!--end::Nav item-->
        </ul>
        <!--end::Nav-->
    </div>

</div>
<div class="tab-content py-4" id="myTabContent">
    <div class="tab-pane fade show active" id="kt_tab_pane_1" role="tabpanel">
        Overview
    </div>
    <div class="tab-pane fade" id="kt_tab_pane_2" role="tabpanel">
        
        <div class="card pt-4 mb-6 mb-xl-9">
            <!--begin::Card header-->
            <div class="card-header border-0">
                <!--begin::Card title-->
                <div class="card-title">
                    <partial name="_DatatableCardHeader" />
                </div>
                <!--end::Card title-->
            </div>
            <!--end::Card header-->
            <!--begin::Card body-->
            <div class="card-body pt-0 pb-5">
                <!--begin::Table-->
                <div>
                    <div class="table-responsive">
                        <table id="kt_datatable_zero_configuration" class="js-datatables table table-row-dashed table-row-gray-300 gy-3 align-middle">
                            <thead>
                                <tr class="fw-bold fs-6 text-gray-800">
                                    <th>Date</th>
                                    <th>StartTime</th>
                                    <th>EndTime</th>
                                    <th>Status</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!--Data Generated Here-->
                                @foreach (var appointment in Model.Appointments)
                                {
                                    <tr>
                                        <td>@appointment.Start.ToString("ddd dd MMM yy")</td>
                                        <td>
                                            <span class="badge badge-light-info">@appointment.StartTime</span>
                                        </td>
                                        <td>
                                            <span class="badge badge-light-info">@appointment.EndTime</span>
                                        </td>
                                        <td>
                                            @{
                                                DateOnly today = DateOnly.FromDateTime(DateTime.Today);
                                                TimeOnly time = TimeOnly.FromDateTime(DateTime.Now);
                                                DateTime dt1 = DateTime.Parse(appointment.Start.ToString()).Date;
                                                DateTime dt2 = DateTime.Parse(today.ToString()).Date;
                                                int result = DateTime.Compare(dt1, dt2);
                                                if (result > 0 || (result == 0 && appointment.StartTime.CompareTo(time) >= 0))
                                                {
                                                    <span class="badge badge-light-success">upcomming</span>

                                                }
                                                else
                                                {
                                                    <span class="badge badge-light-danger">previous</span>
                                                }
                                            }
                                        </td>
                                        <td class="text-center">
                                            <a href="#" class="btn btn-light btn-active-light-primary btn-flex btn-center btn-sm" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
                                                Actions
                                                <span class="svg-icon svg-icon-muted svg-icon-5">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M11.4343 12.7344L7.25 8.55005C6.83579 8.13583 6.16421 8.13584 5.75 8.55005C5.33579 8.96426 5.33579 9.63583 5.75 10.05L11.2929 15.5929C11.6834 15.9835 12.3166 15.9835 12.7071 15.5929L18.25 10.05C18.6642 9.63584 18.6642 8.96426 18.25 8.55005C17.8358 8.13584 17.1642 8.13584 16.75 8.55005L12.5657 12.7344C12.2533 13.0468 11.7467 13.0468 11.4343 12.7344Z" fill="currentColor" />
                                                    </svg>
                                                </span>
                                            </a>
                                            <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4" data-kt-menu="true" style="">
                                                <div class="menu-item px-3">
                                                    <a href="javascript:;" class="menu-link px-3 js-show-prescription">
                                                        Prescription
                                                    </a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>

                        </table>
                    </div>
                </div>
                <!--end::Table-->
            </div>
            <!--end::Card body-->
        </div>



    </div>
    <div class="tab-pane fade" id="kt_tab_pane_3" role="tabpanel">
        Prescriptions
    </div>
    <div class="tab-pane fade" id="kt_tab_pane_4" role="tabpanel">
        <div class="card pt-4 mb-6 mb-xl-9">
            <!--begin::Card header-->
            <div class="card-header border-0">
                <div class="d-flex flex-wrap flex-stack pt-3 pb-8 w-100">
                    <!--begin::Heading-->
                    <h3 class="fw-bold my-2">
                        Medical History
                    </h3>
                    <!--end::Heading-->
                    <!--begin::Filter-->
                    <button type="button" class="btn btn-sm btn-flex btn-light-primary js-report-modal" data-title="Add New Report" data-url="/MedicalReports/Create/@Model.Id">
                        <i class="bi bi-plus-square-dotted"></i>
                        Add Report
                    </button>
                    <!--end::Filter-->
                </div>
            </div>
            <!--end::Card header-->
            <div class="card-body pt-0 pb-5">
                <!--begin::Row-->
                <div class="row g-9 reports-container">
                    <!--begin::Col-->
                    @foreach (var medicalHistory in Model.MedicalHistories!)
                    {
                        <partial name="_MdeicalReport" model="medicalHistory" />

                    }

                    <!--end::Col-->
                </div>
                <!--end::Row-->

                <div class="modal fade" id="Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered mw-650px">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="ModalLabel"></h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <!--Generated By Javascript-->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- light box overlay -->
                <div class="lightBox-overlay d-none justify-content-center align-items-center">
                    <a href="javascript:;" class="lightbox-arrow lightbox-arrow-left">
                        <i class="fa-solid fa-chevron-left"></i>
                    </a>
                    <div class="image-center-container d-flex flex-column align-items-center">
                        <img class="image-center" src="" alt="center">
                    </div>
                    <a href="javascript:;" class="lightbox-arrow lightbox-arrow-right">
                        <i class="fa-solid fa-chevron-right"></i>
                    </a>
                </div>

            </div>

        </div>
    </div>
    <div class="tab-pane fade" id="kt_tab_pane_5" role="tabpanel">
        <div class="card pt-4 mb-6 mb-xl-9">
            <!--begin::Card header-->
            <div class="card-header border-0">
                <!--begin::Card title-->
                <div class="card-title">
                    <partial name="_DatatableCardHeader" />
                </div>
                <!--end::Card title-->
                <!--begin::Card toolbar-->
                <div class="card-toolbar">
                    <!--begin::Filter-->
                    <button type="button" class="btn btn-sm btn-flex btn-light-primary" data-bs-toggle="modal" data-bs-target="#paymentRecords">
                        <i class="bi bi-plus-square-dotted"></i>
                        Add payment
                    </button>
                    <!--end::Filter-->
                </div>
                <!--end::Card toolbar-->
            </div>
            <!--end::Card header-->
            <!--begin::Card body-->
            <div class="card-body pt-0 pb-5">
                <!--begin::Table-->
                <div>
                    <div class="table-responsive">
                        <table id="kt_datatable_zero_configuration" class="js-datatables table table-row-dashed table-row-gray-300 gy-3 align-middle">
                            <thead>
                                <tr class="fw-bold fs-6 text-gray-800">
                                    <th>Date</th>
                                    <th>Operation</th>
                                    <th>Paid</th>
                                    <th>Note</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!--Data Generated Here-->
                            </tbody>

                        </table>
                    </div>
                </div>
                <!--end::Table-->
            </div>
            <!--end::Card body-->
        </div>
        <div class="modal fade" id="paymentRecords" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered mw-650px">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Add Payment</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="paymentForm" class="form fv-plugins-bootstrap5 fv-plugins-framework">
                            <div class="mb-3">
                                <div class="form-floating mb-2">
                                    <input type="date" class="form-control form-control-solid payment-date" name="payment_date" id="PaymentDate" placeholder="payment date..." />
                                    <label class="form-label">Payment Date</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-floating mb-2">
                                    <input class="form-control form-control-solid payment-type" type="text" name="payment_type" id="PaymentType" placeholder="Type.." />
                                    <label class="form-label">Payment Operation</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-floating mb-2">
                                    <input class="form-control form-control-solid payment-value" type="number" name="payment_value" id="PaymentValue" placeholder="Value.." />
                                    <label class="form-label">Payment Amount</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <textarea class="form-control form-control-solid rounded-3 payment-note" name="payment_note" style="height: 96px;" placeholder="payment note..."></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-sm btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn-sm btn btn-primary me-2 js-add-payment">
                            <span class="indicator-label">
                                Create
                            </span>
                            <span class="indicator-progress">
                                Please wait... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<input type="hidden" name="__RequestVerificationToken" value="@antiforgery.GetAndStoreTokens(Context).RequestToken" id="tokkenForgery" />



@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/assets/Plugins/datatables/datatables.bundle.js"></script>
    <script src="~/js/patientDetails.js" asp-append-version="true"></script>

}